(function(){var j,m,b,k,h,a,f,l,n,d,i,e,g={}.hasOwnProperty,c=function(r,p){for(var o in p){if(g.call(p,o)){r[o]=p[o]}}function q(){this.constructor=r}q.prototype=p.prototype;r.prototype=new q();r.__super__=p.prototype;return r};e=(function(){function o(p,q){if(p==null){p=0}if(q==null){q=0}this.set(p,q)}o.prototype.set=function(p,q){if(p==null){p=0}if(q==null){q=0}this.x=p;this.y=q;return this};o.prototype.add=function(p){this.x+=p.x;this.y+=p.y;return this};o.prototype.sub=function(p){this.x-=p.x;this.y-=p.y;return this};o.prototype.scale=function(p){this.x*=p;this.y*=p;return this};o.prototype.div=function(p){this.x/=p;this.y/=p;return this};o.prototype.product=function(p){return this.x*p.x+this.y*p.y};o.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};o.prototype.resize=function(p){if(this.length()){this.scale(p/this.length())}return this};o.prototype.normalize=function(){return this.resize(1)};o.prototype.angle=function(){return(180*Math.atan2(this.y,this.x))/Math.PI};o.prototype.rotate=function(s){var q,r,p,t;q=(s*Math.PI)/180;r=this.length();p=this.x;t=this.y;this.x=Math.sin(q)*t+Math.cos(q)*p;this.y=Math.cos(q)*t-Math.sin(q)*p;return this.resize(r)};o.prototype.clone=function(){return new o(this.x,this.y)};o.prototype.reverse=function(){this.x*=-1;this.y*=-1;return this};o.prototype.max=function(p){if(this.length()<=p){return this}return this.resize(p)};o.prototype.min=function(p){if(this.length()>=p){return this}return this.resize(p)};o.prototype.isZero=function(){return this.x===0&&this.y===0};return o})();Array.prototype._index=function(o){var p;if(o<0){p=this.length;return p+o}return o};Array.prototype.at=function(o){return this[this._index(o)]};Array.prototype.map=function(o){var q,p;return([].splice.apply(this,[0,this.length-0].concat(p=(function(){var t,s,r;r=[];for(t=0,s=this.length;t<s;t++){q=this[t];r.push(o(q))}return r}).call(this))),p)};Array.prototype.clone=function(){return this.dup()};Array.prototype.dup=function(){return this.slice(0,this.length)};Array.prototype.each=function(p){var o,r,q;for(o=r=0,q=this.length;0<=q?r<q:r>q;o=0<=q?++r:--r){p(this[o],o)}return this};Array.prototype.deleteAt=function(o){o=this._index(o);if(o>=this.length){return void 0}return this.splice(o,1)};Array.prototype.deleteIf=function(p){var o;return this.replace((function(){var s,r,q;q=[];for(o=s=0,r=this.length;0<=r?s<r:s>r;o=0<=r?++s:--s){if(!p(this[o],o)){q.push(this[o])}}return q}).call(this))};Array.prototype.reject=function(o){var p;p=this.length;this.deleteIf(o);if(p===this.length){return void 0}return this};Array.prototype.isEmpty=function(){return this.length===0};Array.prototype.isEql=function(o,s){var p,r,q;if(s==null){s=function(u,t){return u===t}}if(this.length!==o.length){return false}for(p=r=0,q=this.length;0<=q?r<q:r>q;p=0<=q?++r:--r){if(!s(this[p],o[p])){return false}}return true};Array.prototype.fill=function(r,s,o){var p,q;if(s==null){s=0}if(o==null){o=this.length-1}s=this._index(s);o=this._index(o);[].splice.apply(this,[s,o-s+1].concat(q=(function(){var u,t;t=[];for(p=u=s;s<=o?u<=o:u>=o;p=s<=o?++u:--u){t.push(r)}return t})())),q;return this};Array.prototype.first=function(){return this[0]};Array.prototype.last=function(){var o;o=this._index(-1);return this[o]};Array.prototype.uniq=function(s){var r,q,p,o;if(s==null){s=function(u,t){return u===t}}r=[];for(p=0,o=this.length;p<o;p++){q=this[p];if(!r.isInclude(q,s)){r.push(q)}}return this.replace(r)};Array.prototype.index=function(r,s){var o,q,p;if(s==null){s=function(u,t){return u===t}}for(o=q=0,p=this.length;0<=p?q<p:q>p;o=0<=p?++q:--q){if(s(this[o],r)){return o}}return void 0};Array.prototype.indexes=function(){var q,r,p,o;o=[];for(r=0,p=arguments.length;r<p;r++){q=arguments[r];o.push(this.at(q))}return o};Array.prototype.rindex=function(r,s){var o,q,p;if(s==null){s=function(u,t){return u===t}}for(o=q=p=this.length;p<=0?q<0:q>0;o=p<=0?++q:--q){if(s(this[o],r)){return o}}return void 0};Array.prototype.flatten=function(){return this.replace(this.reduce(function(p,o){return p.concat(o instanceof Array?o.flatten():o)},[]))};Array.prototype.transpose=function(){var s,r,q,p,o,z,v,u;p=this.isEmpty()?0:this.length;s=this.first() instanceof Array?this.first().length:0;if(!p||!s){return this}q=(function(){var w,t;t=[];for(r=w=0;0<=s?w<s:w>s;r=0<=s?++w:--w){t.push([])}return t})();for(o=v=0;0<=p?v<p:v>p;o=0<=p?++v:--v){for(z=u=0;0<=s?u<s:u>s;z=0<=s?++u:--u){q[z][o]=this[o][z]}}return this.replace(q)};Array.prototype.compact=function(){return this.deleteIf(function(o){return o===void 0})};Array.prototype.isInclude=function(r,s){var p,q,o;if(s==null){s=function(u,t){return u===t}}for(q=0,o=this.length;q<o;q++){p=this[q];if(s(p,r)){return true}}return false};Array.prototype.size=function(){return this.length};Array.prototype.swap=function(p,o){var q;p=this._index(p);o=this._index(o);q=this[p];this[p]=this[o];this[o]=q;return this};Array.prototype.shuffle=function(){var o,q,p;for(o=q=0,p=this.length;0<=p?q<p:q>p;o=0<=p?++q:--q){this.swap(o,Math.floor(Math.random()*this.length))}return this};Array.prototype.choice=function(){return this[Math.floor(Math.random()*this.length)]};Array.prototype.count=function(s,t){var o,p,r,q;if(t==null){t=function(v,u){return v===u}}p=0;for(o=r=0,q=this.length;0<=q?r<q:r>q;o=0<=q?++r:--r){if(t(this[o],s)){++p}}return p};Array.prototype.replace=function(o){var q,r,p;this.clear();for(r=0,p=o.length;r<p;r++){q=o[r];this.push(q)}return this};Array.prototype.nitems=function(){return this.clone().compact().size()};Array.prototype.insert=function(){var q,r,p,o,t,s;q=Array.prototype.slice.call(arguments,0,arguments.length);if(q.size()<=1){return this}p=this._index(q[0]);o=q.slice(1,this.length);for(r=t=0,s=o.length;0<=s?t<s:t>s;r=0<=s?++t:--t){this.splice(p+r,0,o[r])}return this};Array.prototype.clear=function(){var o;o=[];while(!this.isEmpty()){o.push(this.deleteAt(0))}return o};Array.prototype.max=function(p){var o;if(p==null){p=function(r,q){if(r===q){return 0}if(r<q){return -1}else{return 1}}}o=this.first();this.reduce(function(r,q){if(p(o,q)<0){return o=q}});return o};Array.prototype.min=function(p){var o;if(p==null){p=function(r,q){if(r===q){return 0}if(r<q){return -1}else{return 1}}}o=this.first();this.reduce(function(r,q){if(p(o,q)>=0){return o=q}});return o};i=(function(){function o(p,r,t,s,q){if(r==null){r=false}if(t==null){t=0}if(s==null){s=false}if(q==null){q=void 0}this.set(p);this._time=t;this._active=s;this._complete=q;this._repeat=r}o.prototype.set=function(p){if(p==null){p=0}this._max=p;return this};o.prototype.play=function(){this._active=true;return this};o.prototype.stop=function(){this._active=false;this._time=0;return this};o.prototype.pause=function(){this._active=false;return this};o.prototype.reset=function(){this._time=0;return this};o.prototype.tick=function(){if(this._time<this._max&&this._active){++this._time;if(this._time===this._max){if(this._complete!=null){this._complete()}if(this._repeat){this._time=0}}}return this};o.prototype.now=function(){return this._time};o.prototype.max=function(){return this._max};o.prototype.setNow=function(p){this._time=p;return this};o.prototype.setComplete=function(p){this._complete=p;return this};o.prototype.setRepeat=function(p){this._repeat=p;return this};o.prototype.isActive=function(){return this._active};o.prototype.isOver=function(){return this._time>=this._max};return o})();m=(function(){function o(){}o._sounds=[];o.root="";o.load=function(){var t,p,s,r,q;p=Array.prototype.slice.call(arguments);q=[];for(s=0,r=p.length;s<r;s++){t=p[s];q.push(o._loadSound(t))}return q};o.play=function(p){if(!(o._sounds[p]!=null)){o._loadSound(p)}o.stop(p);return o._sounds[p].play()};o.pause=function(p){if(p!=null){return o._sounds[p].pause()}};o.stop=function(p){if(p!=null){return o._sounds[p].stop()}};o._loadSound=function(q,p){if(!(o._sounds[q]!=null)){if(p!=null){return o._sounds[q]=Sound.load(""+o.root+q,p)}else{return o._sounds[q]=Sound.load(""+o.root+q)}}};return o})();enchant();k=(function(p){c(o,p);o.prototype.config={WIDTH:640,HEIGHT:480,FPS:30,FONT:"Helvetica",IMAGE_PATH:"/image/",IMAGES:["kawaz.png","chips/grass.png","cursor0.png"],SOUND_PATH:"/sound/",SOUNDS:[],INITIAL_LEVEL:1,LAST_LEVEL:7,LEVEL_TIME:30};function o(){var u,r,t,q,s;o.__super__.constructor.call(this,this.config.WIDTH,this.config.HEIGHT);this.fps=this.config.FPS;this.keybind(90,"a");this.keybind(88,"b");o.game=this;o.config=this.config;s=this.config.IMAGES;for(t=0,q=s.length;t<q;t++){u=s[t];this.preload(""+this.config.IMAGE_PATH+u)}r=new b();this.onload=function(){r.setup();return this.pushScene(r)};this.start()}return o})(Game);window.onload=function(){return new k()};j=(function(o){c(p,o);function p(r,s,q,t){if(q==null){q=0}if(t==null){t=0}p.__super__.constructor.call(this,r,s);this.removeEventListener("enterframe");this.x=q;this.y=t;this.v=new e();this.speed=7}p.prototype.update=function(q){this.x+=this.v.x;return this.y+=this.v.y};p.prototype.setImage=function(q){return this.image=k.game.assets[""+k.config.IMAGE_PATH+q]};p.prototype.position=function(){return new e(this.x,this.y)};p.prototype.center=function(){return new e(this.x+this.width/2,this.y+this.height/2)};return p})(Sprite);d={None:0,Floor:1,Wall:2};l=(function(p){c(o,p);o.WIDTH=48;o.HEIGHT=48;function o(){o.__super__.constructor.call(this,o.WIDTH,o.HEIGHT);this.setImage("chips/grass.png")}return o})(j);f={Left:0,Right:1};n=(function(){function o(t,q,p,r,s){this.lu=t;this.ld=q;this.ru=p;this.rd=r;this.count=0;this.direction=s}o.prototype.update=function(){var p;if(!this.isEnd()){if(this.direction===f.Left){p=10}else{p=-10}this.lu.rotation+=p;this.ld.rotation+=p;this.ru.rotation+=p;this.rd.rotation+=p;return this.count+=1}};o.prototype.isEnd=function(){return this.count>=9};return o})();a=(function(p){c(o,p);function o(s,r){var u,q,w,v,t;o.__super__.constructor.apply(this,arguments);this._map=[];for(q=v=0;0<=s?v<s:v>s;q=0<=s?++v:--v){this._map.push([]);for(w=t=0;0<=r?t<r:t>r;w=0<=r?++t:--t){u=new l();u.x=q*48;u.y=w*48;this._map[q].push(u);this.addChild(u)}}this.width=s;this.height=r}o.prototype.getTile=function(q,r){return this._map[q][r]};o.prototype.rotate=function(z,u,v){var t,q,s,C,r,B,A;if(z<0||z>=this.width-1||u<0||u>=this.height){return null}s=this.getTile(z,u);q=this.getTile(z,u+1);r=this.getTile(z+1,u);C=this.getTile(z+1,u+1);A=s.width;t=s.height;s.originX=A*1;s.originY=t*1;q.originX=A*1;q.originY=0;r.originX=0;r.originY=t*1;C.originX=0;C.originY=0;B=new n(s,q,r,C,v);return B};o.prototype.localToGlobal=function(q,r){return this};o.prototype.globalToLocal=function(q,r){return new e(Math.floor(q/l.WIDTH),Math.floor(r/l.HEIGHT))};return o})(Group);h=(function(p){c(o,p);function o(){var q;o.__super__.constructor.apply(this,arguments);this.stage=new a(10,10);this.addChild(this.stage);this.addEventListener("enterframe",this.update);this.cursor=new j(144,144);this.cursor.setImage("cursor0.png");this.cursor.x=0;this.cursor.y=100;q=document.getElementById("enchant-stage");q.scene=this;q.addEventListener("mousemove",this.updateMousePosition);this.addEventListener("touchstart",this.onMousePressed);this.addChild(this.cursor);this.tileSetQueue=[]}o.prototype.setup=function(){return this};o.prototype.update=function(u){var v,t,r,s,q;s=this.tileSetQueue;q=[];for(t=0,r=s.length;t<r;t++){v=s[t];v.update();if(v.isEnd()){q.push(this.tileSetQueue.deleteAt(this.tileSetQueue.index(v)))}else{q.push(void 0)}}return q};o.prototype.updateMousePosition=function(r){var s,q;s=this.scene.cursor;q=this.scene.stage.globalToLocal(r.clientX,r.clientY);s.x=l.WIDTH*q.x-144/2;return s.y=l.HEIGHT*q.y-144/2};o.prototype.onMousePressed=function(r){var s,q;q=this.stage.globalToLocal(r.x-l.WIDTH,r.y-l.HEIGHT);s=this.stage.rotate(q.x,q.y,f.Left);if(s!==null){return this.tileSetQueue.push(s)}};o.prototype.rotate=function(q){return this};return o})(Scene);b=(function(p){c(o,p);function o(){return o.__super__.constructor.apply(this,arguments)}o.prototype.setup=function(){this.kawaz=new j(253,81);this.kawaz.setImage("kawaz.png");this.kawaz.x=193.5;this.kawaz.y=220;this.kawaz.opacity=0;this.addChild(this.kawaz);this.addEventListener("enterframe",this.update);this.timer=new i(180);this.timer.setComplete(function(){k.game.replaceScene(new h());return this});return this.timer.play()};o.prototype.update=function(){if(k.game.input.a){k.game.replaceScene(new h());this}this.timer.tick();if(this.timer.now()<60){return this.kawaz.opacity+=1/60}else{if(this.timer.now()>120){return this.kawaz.opacity-=1/60}}};return o})(Scene)}).call(this);